#! /usr/bin/env stap

global syscall_count

probe begin {
    print("Collecting system-call data for the whole system\n")
    print("Top 20 system-calls will be displayed for the interval of 10 seconds\n")
    print("Type Ctrl+c to exit the program\n\n\n")
}

probe syscall.* {
    syscall_count[execname()] <<< 1
}

function print_top_systemcall() {
    print("%25s %10s\n", "SYSTEM-CALL", "COUNT")
    foreach(proc in syscall_count- limit 20) {
        print("%25s %10s\n", proc, @count(syscall_count[proc]))
    }
    delete syscall_count
}

probe timer.s(10) {
    print_top_systemcall()
    print("***************<>***************\n");
}