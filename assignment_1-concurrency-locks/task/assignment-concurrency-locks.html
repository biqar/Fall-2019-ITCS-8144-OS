<!DOCTYPE html>
    <html>
    <head>
        <meta http-equiv="Content-type" content="text/html;charset=UTF-8">
        <title>ITCS 6144/8144 Assignment - Pthread Lock</title>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.2/dist/katex.min.css" integrity="sha384-yFRtMMDnQtDRO8rLpMIKrtPCD5jdktao2TV19YiZYWMDkUR5GQZR/NOVTdquEx1j" crossorigin="anonymous">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/markdown.css">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/highlight.css">
        <link href="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.css" rel="stylesheet" type="text/css">
        <style>
.task-list-item { list-style-type: none; } .task-list-item-checkbox { margin-left: -20px; vertical-align: middle; }
</style>
        <style>
            body {
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe WPC', 'Segoe UI', 'Ubuntu', 'Droid Sans', sans-serif;
                font-size: 14px;
                line-height: 1.6;
            }
        </style>
        
        <script src="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.js"></script>
    </head>
    <body>
        <h1 id="itcs-61448144-assignment---pthread-lock">ITCS 6144/8144 Assignment - Pthread Lock</h1>
<ul>
<li><a href="#itcs-61448144-assignment---pthread-lock">ITCS 6144/8144 Assignment - Pthread Lock</a>
<ul>
<li><a href="#metadata">Metadata</a></li>
<li><a href="#assignment-description">Assignment Description</a>
<ul>
<li><a href="#needed-programs">Needed Programs</a></li>
<li><a href="#submissions">Submissions</a></li>
</ul>
</li>
<li><a href="#hints">Hints</a>
<ul>
<li><a href="#pthread">Pthread</a></li>
<li><a href="#pthread-locks">Pthread Locks</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="metadata">Metadata</h2>
<table>
<thead>
<tr>
<th>Key</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>type</td>
<td>coding assignment</td>
</tr>
<tr>
<td>topic</td>
<td>Concurrency and Lock</td>
</tr>
<tr>
<td>release date</td>
<td>Sept. 10</td>
</tr>
<tr>
<td>deadline</td>
<td>Sept. 24</td>
</tr>
<tr>
<td>hand-in</td>
<td>a zip/rar file, including README, Makefile, Codes, Report</td>
</tr>
<tr>
<td>platform</td>
<td>Linux Only (Ubuntu)</td>
</tr>
<tr>
<td>language</td>
<td>C Only</td>
</tr>
</tbody>
</table>
<h2 id="assignment-description">Assignment Description</h2>
<p>In this assignment, you will develop several multi-threaded pthread programs using different types of locks and compare their performance on different workloads. Detailed requirements on each of these programs are listed below.</p>
<h3 id="needed-programs">Needed Programs</h3>
<ul>
<li><strong>Program 1: Mutex Lock and Spin Lock</strong>
<ul>
<li>develop a program using both pthread <strong>Mutex Lock</strong> and <strong>Spin Lock</strong></li>
<li>the program takes <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">n</span></span></span></span> as the input parameter to denote how many threads will be created. n <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>∈</mo></mrow><annotation encoding="application/x-tex">\in</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mrel">∈</span></span></span></span> [2, 4, 8].</li>
<li>each thread runs 100,000 times in a loop</li>
<li>in each loop, each thread adds <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span> to a shared variable (<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.03148em;">k</span></span></span></span>) [1, 1,000, 1,000,000] times (three run cases) with lock acquired</li>
<li>for each <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">n</span></span></span></span>, run the program three times [1, 1,000, 1,000,000].</li>
<li>compare the execution time of using different locks for different cases and different numbers of threads.</li>
</ul>
</li>
<li><strong>Program 2: Condition Variable</strong>
<ul>
<li>develop a program using pthread <strong>Condition Variable</strong></li>
<li>the program takes <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">n</span></span></span></span> as the input parameter to denote how many threads will be created. n <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>∈</mo></mrow><annotation encoding="application/x-tex">\in</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mrel">∈</span></span></span></span> [1, 2, 4, 8].</li>
<li><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi><mo>−</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">n-1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="mord mathdefault">n</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span> threads randomly add <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span> to a shared variable (<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.03148em;">k</span></span></span></span>) in an interval of <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>100</mn></mrow><annotation encoding="application/x-tex">100</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span><span class="mord">0</span><span class="mord">0</span></span></span></span> ms</li>
<li>one thread wait until that shared variable reaches <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>100</mn></mrow><annotation encoding="application/x-tex">100</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span><span class="mord">0</span><span class="mord">0</span></span></span></span> and print something</li>
<li>no performance comparison; just show the execution time of your program</li>
</ul>
</li>
<li><strong>Program 3: Reader/Writer Lock</strong>
<ul>
<li>develop a program using both pthread <strong>Reader/Writer Lock</strong> and <strong>Mutex Lock</strong> to implement the same logic</li>
<li>the program takes <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">n</span></span></span></span> as the input parameter to denote how many readers(<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">n</span></span></span></span>) will be created. n <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>∈</mo></mrow><annotation encoding="application/x-tex">\in</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mrel">∈</span></span></span></span> [2, 4, 8] and <strong>one</strong> writer</li>
<li>each of the <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">n</span></span></span></span> readers reads a shared variable (<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.03148em;">k</span></span></span></span>) 10,000 times</li>
<li>the writer adds <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span> to the shared variable (<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.03148em;">k</span></span></span></span>) 10,000 times</li>
<li>compare the execution time of using different locks</li>
<li>identify and show when <code>write</code> happens</li>
</ul>
</li>
</ul>
<p>If you like, you can use more advanced locks (<strong>MCS</strong> and <strong>RCU</strong>) to implement the same <strong>Program 1</strong> and compare the performance with mutex lock and spin lock. You will get extra points.</p>
<h3 id="submissions">Submissions</h3>
<p>The submitted package should include:</p>
<ol>
<li>a <code>README</code> file describing how to compile and run your code;</li>
<li>a <code>Makefile</code> to help me easily repeat your program
<ul>
<li>since we do not have TA, I will not be responsible for learning how to run your program;</li>
</ul>
</li>
<li>your <code>Source Code</code>;</li>
<li>a <code>Report</code> describing
<ol>
<li>your test platform</li>
<li>your results (better with plots)</li>
<li>explain why you get the results</li>
</ol>
</li>
</ol>
<h2 id="hints">Hints</h2>
<h3 id="pthread">Pthread</h3>
<ul>
<li>A standardized multi-threaded programming interface.</li>
<li>A very good pthread tutorial: <a href="https://computing.llnl.gov/tutorials/pthreads/">https://computing.llnl.gov/tutorials/pthreads/</a></li>
</ul>
<pre><code class="language-c"><div><span class="hljs-comment">/*
 * Please compile with gcc -Wall helloworld_pthreads.c -lpthread
 */</span>

<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;pthread.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdlib.h&gt;</span></span>

<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> NUM_THREADS	10</span>

<span class="hljs-function"><span class="hljs-keyword">void</span> *<span class="hljs-title">print_hello_world</span><span class="hljs-params">(<span class="hljs-keyword">void</span> *tid)</span>
</span>{
   <span class="hljs-keyword">long</span> threadid;
   threadid = (<span class="hljs-keyword">long</span>)tid;
   <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Hello World! Greetings from thread #%ld!\n"</span>, threadid);
   pthread_exit(<span class="hljs-literal">NULL</span>);
}

<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span> *argv[])</span>
</span>{
   <span class="hljs-keyword">pthread_t</span> threads[NUM_THREADS];
   <span class="hljs-keyword">int</span> status;
   <span class="hljs-keyword">long</span> i;

   <span class="hljs-keyword">for</span>(i=<span class="hljs-number">0</span>; i&lt;NUM_THREADS; i++){
     <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Main here. Creating thread %ld\n"</span>, i);
     status = pthread_create(&amp;threads[i], <span class="hljs-literal">NULL</span>, print_hello_world, (<span class="hljs-keyword">void</span> *)i);
     <span class="hljs-keyword">if</span> (status != <span class="hljs-number">0</span>){
       <span class="hljs-built_in">printf</span>(<span class="hljs-string">"ERROR; return code from pthread_create() is %d\n"</span>, status);
       <span class="hljs-built_in">exit</span>(<span class="hljs-number">-1</span>);
       }
     }
   pthread_exit(<span class="hljs-literal">NULL</span>);
}
</div></code></pre>
<h3 id="pthread-locks">Pthread Locks</h3>
<ul>
<li>Mutex Lock
<ul>
<li><code>pthread_mutex_init</code></li>
<li><code>pthread_mutex_destroy</code></li>
<li><code>pthread_mutex_lock</code></li>
<li><code>pthread_mutex_unlock</code></li>
<li><code>pthread_mutex_trylock</code></li>
</ul>
</li>
<li>Condition Variable
<ul>
<li><code>pthread_cond_init</code></li>
<li><code>pthread_cond_destroy</code></li>
<li><code>pthread_cond_signal</code></li>
<li><code>pthread_cond_broadcast</code></li>
<li><code>pthread_cond_wait</code></li>
<li><code>pthread_cond_timedwait</code></li>
</ul>
</li>
<li>Reader/Writer Lock
<ul>
<li><code>pthread_rwlock_init</code></li>
<li><code>pthread_rwlock_destroy</code></li>
<li><code>pthread_rwlock_rdlock</code> and <code>pthread_rwlock_tryrdlock</code></li>
<li><code>pthread_rwlock_wrlock</code> and <code>pthread_rwlock_trywrlock</code></li>
<li><code>pthread_rwlock_unlock</code></li>
</ul>
</li>
<li>Spin Lock
<ul>
<li><code>pthread_spin_init</code></li>
<li><code>pthread_spin_destroy</code></li>
<li><code>pthread_spin_lock</code> and <code>pthread_spin_trylock</code></li>
<li><code>pthread_spin_unlock</code></li>
</ul>
</li>
</ul>
<p>Optional</p>
<ul>
<li>Userspace RCU: <a href="https://liburcu.org">https://liburcu.org</a></li>
<li>MCS Lock: Implement your own.</li>
</ul>

    </body>
    </html>